DROP DATABASE IF EXISTS totesys_test_subset;
CREATE DATABASE totesys_test_subset;

\c totesys_test_subset

SET session_replication_role = replica;

CREATE TABLE "sales_order" (
  "sales_order_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp),
  "design_id" int NOT NULL,
  "staff_id" int NOT NULL,
  "counterparty_id" int NOT NULL,
  "units_sold" int NOT NULL,
  "unit_price" numeric NOT NULL,
  "currency_id" int NOT NULL,
  "agreed_delivery_date" varchar NOT NULL,
  "agreed_payment_date" varchar NOT NULL,
  "agreed_delivery_location_id" int NOT NULL
);

CREATE TABLE "design" (
  "design_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp),
  "design_name" varchar NOT NULL,
  "file_location" varchar NOT NULL,
  "file_name" varchar NOT NULL
);

CREATE TABLE "currency" (
  "currency_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "currency_code" varchar(3) NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp)
);

CREATE TABLE "staff" (
  "staff_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "first_name" varchar NOT NULL,
  "last_name" varchar NOT NULL,
  "department_id" int NOT NULL,
  "email_address" varchar NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp)
);

CREATE TABLE "counterparty" (
  "counterparty_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "counterparty_legal_name" varchar NOT NULL,
  "legal_address_id" int NOT NULL,
  "commercial_contact" varchar,
  "delivery_contact" varchar,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp)
);

CREATE TABLE "address" (
  "address_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "address_line_1" varchar NOT NULL,
  "address_line_2" varchar,
  "district" varchar,
  "city" varchar NOT NULL,
  "postal_code" varchar NOT NULL,
  "country" varchar NOT NULL,
  "phone" varchar NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp)
);

CREATE TABLE "department" (
  "department_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "department_name" varchar NOT NULL,
  "location" varchar,
  "manager" varchar,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp)
);

CREATE TABLE "purchase_order" (
  "purchase_order_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp),
  "staff_id" int NOT NULL,
  "counterparty_id" int NOT NULL,
  "item_code" varchar NOT NULL,
  "item_quantity" int NOT NULL,
  "item_unit_price" numeric NOT NULL,
  "currency_id" int NOT NULL,
  "agreed_delivery_date" varchar NOT NULL,
  "agreed_payment_date" varchar NOT NULL,
  "agreed_delivery_location_id" int NOT NULL
);

CREATE TABLE "payment_type" (
  "payment_type_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "payment_type_name" varchar NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp)
);

CREATE TABLE "payment" (
  "payment_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp),
  "transaction_id" int NOT NULL,
  "counterparty_id" int NOT NULL,
  "payment_amount" numeric NOT NULL,
  "currency_id" int NOT NULL,
  "payment_type_id" int NOT NULL,
  "paid" boolean NOT NULL,
  "payment_date" varchar NOT NULL,
  "company_ac_number" int NOT NULL,
  "counterparty_ac_number" int NOT NULL
);

CREATE TABLE "transaction" (
  "transaction_id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
  "transaction_type" varchar NOT NULL,
  "sales_order_id" int,
  "purchase_order_id" int,
  "created_at" timestamp NOT NULL DEFAULT (current_timestamp),
  "last_updated" timestamp NOT NULL DEFAULT (current_timestamp)
);

COMMENT ON COLUMN "sales_order"."units_sold" IS 'value 1000 - 100000';

COMMENT ON COLUMN "sales_order"."unit_price" IS 'value 2.00 - 4.00';

COMMENT ON COLUMN "sales_order"."agreed_delivery_date" IS 'format is yyyy-mm-dd';

COMMENT ON COLUMN "sales_order"."agreed_payment_date" IS 'format is yyyy-mm-dd';

COMMENT ON COLUMN "design"."file_location" IS 'directory location';

COMMENT ON COLUMN "design"."file_name" IS 'file name';

COMMENT ON COLUMN "currency"."currency_code" IS 'three letter code eg GBP';

COMMENT ON COLUMN "staff"."email_address" IS 'must be valid email address';

COMMENT ON COLUMN "counterparty"."commercial_contact" IS 'person name, nullable';

COMMENT ON COLUMN "counterparty"."delivery_contact" IS 'person name, nullable';

COMMENT ON COLUMN "address"."address_line_2" IS 'nullable';

COMMENT ON COLUMN "address"."district" IS 'nullable';

COMMENT ON COLUMN "address"."phone" IS 'valid phone number';

COMMENT ON COLUMN "department"."location" IS 'nullable';

COMMENT ON COLUMN "department"."manager" IS 'nullable';

COMMENT ON COLUMN "purchase_order"."item_quantity" IS 'value between 1 and 1000';

COMMENT ON COLUMN "purchase_order"."item_unit_price" IS 'value 3-1000';

COMMENT ON COLUMN "purchase_order"."agreed_delivery_date" IS 'format is yyyy-mm-dd';

COMMENT ON COLUMN "purchase_order"."agreed_payment_date" IS 'format is yyyy-mm-dd';

COMMENT ON COLUMN "payment_type"."payment_type_name" IS 'one of SALES_RECEIPT SALESREFUND PURCHASE_PAYMENT PURCHASE REFUND';

COMMENT ON COLUMN "payment"."payment_amount" IS 'value 1 - 1000000';

COMMENT ON COLUMN "payment"."payment_date" IS 'format is yyyy-mm-dd';

COMMENT ON COLUMN "payment"."company_ac_number" IS '8 digits';

COMMENT ON COLUMN "payment"."counterparty_ac_number" IS '8 digits';

COMMENT ON COLUMN "transaction"."transaction_type" IS 'one of SALE or PURCHASE';

COMMENT ON COLUMN "transaction"."sales_order_id" IS 'nullable depending on transaction type';

COMMENT ON COLUMN "transaction"."purchase_order_id" IS 'nullable depending on transaction type';

INSERT INTO public.address (address_id,address_line_1,address_line_2,district,city,postal_code,country,phone,created_at,last_updated) VALUES
	-- time 12:00
	(1, 'Address Line 1', 'Address Line 2 1', 'District 1', 'City 1', '10000', 'UK', '1111111111', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(2, 'Address Line 2', 'Address Line 2 2', 'District 2', 'City 2', '20000', 'UK', '2222222222', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(3, 'Address Line 3', 'Address Line 2 3', 'District 3', 'City 3', '30000', 'UK', '3333333333', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(4, 'Address Line 4', 'Address Line 2 4', 'District 4', 'City 4', '40000', 'UK', '4444444444', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(5, 'Address Line 5', 'Address Line 2 5', 'District 5', 'City 5', '50000', 'UK', '5555555555', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(6, 'Address Line 6', 'Address Line 2 6', 'District 6', 'City 6', '60000', 'UK', '6666666666', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	-- time 15:00
	(7, 'Address Line 7', 'Address Line 2 7', 'District 7', 'City 7', '70000', 'UK', '7777777777', '2024-01-01 15:00:00.000', '2024-01-01 15:00:00.000'),
	(8, 'Address Line 8', 'Address Line 2 8', 'District 8', 'City 8', '80000', 'UK', '8888888888', '2024-01-01 15:00:00.000', '2024-01-01 15:00:00.000'),
	-- time 18:00
	(9, 'Address Line 9', 'Address Line 2 9', 'District 9', 'City 9', '90000', 'UK', '9999999999', '2024-01-01 18:00:00.000', '2024-01-01 18:00:00.000'),
	(10, 'Address Line 10', 'Address Line 2 10', 'District 10', 'City 10', '10001', 'UK', '1010101010', '2024-01-01 18:00:00.000', '2024-01-01 18:00:00.000');

INSERT INTO public.counterparty (counterparty_id,counterparty_legal_name,legal_address_id,commercial_contact,delivery_contact,created_at,last_updated) VALUES
	(1, 'Ð¡ounterparty 1', 1, 'Commercial Contact 1', 'Delivery Contact 1', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(2, 'Counterparty 2', 2, 'Commercial Contact 2', 'Delivery Contact 2', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(3, 'Counterparty 3', 3, 'Commercial Contact 3', 'Delivery Contact 3', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(4, 'Counterparty 4', 4, 'Commercial Contact 4', 'Delivery Contact 4', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(5, 'Counterparty 5', 5, 'Commercial Contact 5', 'Delivery Contact 5', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000');

INSERT INTO public.currency (currency_id,currency_code,created_at,last_updated) VALUES
	(1,'EUR','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000');

INSERT INTO public.department (department_id,department_name,"location",manager,created_at,last_updated) VALUES
	(1,'Dispatch','Leds','Mark Hanna','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(2,'Finance','Manchester','Jordan Belfort','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	(3,'Facilities','Manchester','Shelley Levene','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000');

INSERT INTO public.design (design_id, created_at, last_updated, design_name, file_location, file_name) VALUES
    (1, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 1', '/location/1', 'file-1.json'),
    (2, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 2', '/location/2', 'file-2.json'),
    (3, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 3', '/location/3', 'file-3.json'),
    (4, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 4', '/location/4', 'file-4.json'),
    (5, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 5', '/location/5', 'file-5.json'),
    (6, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 6', '/location/6', 'file-6.json'),
    (7, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 7', '/location/7', 'file-7.json'),
    (8, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 8', '/location/8', 'file-8.json'),
    (9, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 'Design Name 9', '/location/9', 'file-9.json'),
    (10, '2024-01-01 12:00:00.000', '2024-01-01 19:00:00.000', 'Design Name 10', '/location/10', 'file-10.json');

INSERT INTO public.payment_type (payment_type_id,payment_type_name,created_at,last_updated) VALUES
	 (1,'SALES_RECEIPT','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	 (2,'SALES_REFUND','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	 (3,'PURCHASE_PAYMENT','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	 (4,'PURCHASE_REFUND','2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000');

INSERT INTO public.staff (staff_id, first_name, last_name, department_id, email_address, created_at, last_updated) VALUES
    (1, 'First Name 1', 'Last Name 1', 1, 'email1@domain.com', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (2, 'First Name 2', 'Last Name 2', 2, 'email2@domain.com', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (3, 'First Name 3', 'Last Name 3', 3, 'email3@domain.com', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (4, 'First Name 4', 'Last Name 4', 1, 'email4@domain.com', '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
	-- time 18:00
    (5, 'First Name 5', 'Last Name 5', 2, 'email5@domain.com', '2024-01-01 18:00:00.000', '2024-01-01 18:00:00.000'),
    (6, 'First Name 6', 'Last Name 6', 3, 'email6@domain.com', '2024-01-01 18:00:00.000', '2024-01-01 18:00:00.000');

-- payments to supplier (payment_type_id should be 3 or 4)
INSERT INTO public.payment (payment_id, created_at, last_updated, transaction_id, counterparty_id, payment_amount, currency_id, payment_type_id, paid, payment_date, company_ac_number, counterparty_ac_number) VALUES
	(1, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 1, 1, 10000.00, 1, 3, true, '2024-01-01', 12345678, 87654321),
    (2, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 2, 2, 20000.00, 1, 3, false, '2024-01-01', 23456789, 98765432),
    (3, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 3, 3, 30000.00, 1, 3, true, '2024-01-01', 34567890, 19876543),
    (4, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 4, 4, 40000.00, 1, 3, true, '2024-01-01', 45678901, 21987654),
    (5, '2024-01-01 19:00:00.000', '2024-01-01 12:00:00.000', 5, 5, 50000.00, 1, 3, true, '2024-01-01', 56789012, 32098765);


-- buy from supplier
INSERT INTO public.purchase_order (purchase_order_id, created_at, last_updated, staff_id, counterparty_id, item_code, item_quantity, item_unit_price, currency_id, agreed_delivery_date, agreed_payment_date, agreed_delivery_location_id) VALUES
    (1, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 1, 1, 'ITEM001', 100, 100.00, 1, '2024-01-01', '2024-01-01', 5),
    (2, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 2, 2, 'ITEM002', 100, 200.00, 1, '2024-01-01', '2024-01-01', 6),
    (3, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 3, 3, 'ITEM003', 100, 300.00, 1, '2024-01-01', '2024-01-01', 7),
    (4, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 4, 4, 'ITEM004', 100, 400.00, 1, '2024-01-01', '2024-01-01', 8),
    (5, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 5, 5, 'ITEM005', 100, 500.00, 1, '2024-01-01', '2024-01-01', 9);


-- sell to customer
INSERT INTO public.sales_order (sales_order_id, created_at, last_updated, design_id, staff_id, counterparty_id, units_sold, unit_price, currency_id, agreed_delivery_date, agreed_payment_date, agreed_delivery_location_id) VALUES
    (1, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000', 1, 1, 1, 100, 10.00, 1, '2024-01-01', '2024-01-01', 1),
    (2, '2024-01-01 12:00:01.000', '2024-01-01 19:00:01.000', 2, 2, 2, 200, 20.00, 1, '2024-01-01', '2024-01-01', 2),
    (3, '2024-01-01 12:00:02.000', '2024-01-01 12:00:02.000', 3, 3, 3, 300, 30.00, 1, '2024-01-01', '2024-01-01', 3),
    (4, '2024-01-01 12:00:03.000', '2024-01-01 12:00:03.000', 4, 4, 4, 400, 40.00, 1, '2024-01-01', '2024-01-01', 4),
    (5, '2024-01-01 12:00:04.000', '2024-01-01 12:00:04.000', 5, 5, 5, 500, 50.00, 1, '2024-01-01', '2024-01-01', 5);




INSERT INTO public."transaction" (transaction_id, transaction_type, sales_order_id, purchase_order_id, created_at, last_updated) VALUES
    (1, 'PURCHASE', NULL, 1, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (2, 'SALE', 	1, NULL, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (3, 'PURCHASE', NULL, 2, '2024-01-01 12:00:00.000', '2024-01-01 19:00:00.000'),
    (4, 'SALE', 	2, NULL, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (5, 'PURCHASE', NULL, 3, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (6, 'SALE', 	3, NULL, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (7, 'PURCHASE', NULL, 4, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (8, 'SALE', 	4, NULL, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (9, 'PURCHASE', NULL, 5, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000'),
    (10, 'SALE', 	5, NULL, '2024-01-01 12:00:00.000', '2024-01-01 12:00:00.000');





ALTER TABLE "sales_order" ADD FOREIGN KEY ("design_id") REFERENCES "design" ("design_id");

ALTER TABLE "sales_order" ADD FOREIGN KEY ("staff_id") REFERENCES "staff" ("staff_id");

ALTER TABLE "sales_order" ADD FOREIGN KEY ("counterparty_id") REFERENCES "counterparty" ("counterparty_id");

ALTER TABLE "sales_order" ADD FOREIGN KEY ("currency_id") REFERENCES "currency" ("currency_id");

ALTER TABLE "sales_order" ADD FOREIGN KEY ("agreed_delivery_location_id") REFERENCES "address" ("address_id");

ALTER TABLE "staff" ADD FOREIGN KEY ("department_id") REFERENCES "department" ("department_id");

ALTER TABLE "counterparty" ADD FOREIGN KEY ("legal_address_id") REFERENCES "address" ("address_id");

ALTER TABLE "purchase_order" ADD FOREIGN KEY ("staff_id") REFERENCES "staff" ("staff_id");

ALTER TABLE "purchase_order" ADD FOREIGN KEY ("counterparty_id") REFERENCES "counterparty" ("counterparty_id");

ALTER TABLE "purchase_order" ADD FOREIGN KEY ("currency_id") REFERENCES "currency" ("currency_id");

ALTER TABLE "purchase_order" ADD FOREIGN KEY ("agreed_delivery_location_id") REFERENCES "address" ("address_id");

ALTER TABLE "payment" ADD FOREIGN KEY ("transaction_id") REFERENCES "transaction" ("transaction_id");

ALTER TABLE "payment" ADD FOREIGN KEY ("counterparty_id") REFERENCES "counterparty" ("counterparty_id");

ALTER TABLE "payment" ADD FOREIGN KEY ("currency_id") REFERENCES "currency" ("currency_id");

ALTER TABLE "payment" ADD FOREIGN KEY ("payment_type_id") REFERENCES "payment_type" ("payment_type_id");

ALTER TABLE "transaction" ADD FOREIGN KEY ("sales_order_id") REFERENCES "sales_order" ("sales_order_id");

ALTER TABLE "transaction" ADD FOREIGN KEY ("purchase_order_id") REFERENCES "purchase_order" ("purchase_order_id");